import streamlit as st
import random

# è®¾ç½®é¡µé¢
st.set_page_config(page_title="â¤ï¸ æƒ…ä¾£ä¸“å±äº’æŠ½å°æ¸¸æˆ", layout="centered")

# å®šä¹‰æ¡£ä½åç§°
LEVELS = [
    "å¼€å¿ƒäº”æé™ (æœ€å°å¥–)", 
    "äº‹äº‹è‚†å¦‚æ„ (å››ç­‰å¥–)", 
    "é—ªé—ªä¸‰ç”ŸçŸ³ (ä¸‰ç­‰å¥–)", 
    "å¯¹å½±æˆåŒäºº (äºŒç­‰å¥–)", 
    "ä¾å¿ƒä¸€æ„èµ (æœ€å¤§å¥–)"
]

# åˆå§‹åŒ–å…¨å±€æ•°æ®
if 'pools' not in st.session_state:
    st.session_state.pools = {
        "ç©å®¶A": {level: [] for level in LEVELS},
        "ç©å®¶B": {level: [] for level in LEVELS}
    }

st.title("ğŸ æƒ…ä¾£äº’æŠ½æ„¿æœ›æœº")

# --- ç¬¬ä¸€æ­¥ï¼šè®¾ç½®ç¯èŠ‚ ---
with st.expander("ğŸ›  ç¬¬ä¸€æ­¥ï¼šç¼–è¾‘å„è‡ªçš„è®¸æ„¿æ±  (å»ºè®®è½®æµæ“ä½œï¼Œä¸è¦å·çœ‹ï¼)", expanded=True):
    user_choice = st.radio("è¯·é€‰æ‹©ä½ æ˜¯è°ï¼š", ["ç©å®¶A", "ç©å®¶B"], horizontal=True)
    st.warning(f"è¯· {user_choice} è¾“å…¥ä½ çš„æ„¿æœ›ï¼Œç¡®ä¿å¯¹æ–¹ä¸åœ¨èº«è¾¹å“¦ï¼")
    
    for level in LEVELS:
        current_val = "\n".join(st.session_state.pools[user_choice][level])
        new_val = st.text_area(f"ç¼–è¾‘ä½ çš„ã€{level}ã€‘æ„¿æœ› (æ¯è¡Œä¸€ä¸ª):", value=current_val, key=f"input_{user_choice}_{level}")
        st.session_state.pools[user_choice][level] = [p.strip() for p in new_val.split("\n") if p.strip()]
    
    st.success(f"âœ… {user_choice} çš„æ„¿æœ›æ± å·²ä¿å­˜")

st.write("---")

# --- ç¬¬äºŒæ­¥ï¼šæŠ½å¥–ç¯èŠ‚ ---
st.header("âœ¨ ç¬¬äºŒæ­¥ï¼šæŠ½å–å¯¹æ–¹çš„æ„¿æœ›")

current_roller = st.radio("ç°åœ¨æ˜¯è°åœ¨æŠ½å¥–ï¼Ÿ", ["ç©å®¶A", "ç©å®¶B"], horizontal=True, key="roller")
target_user = "ç©å®¶B" if current_roller == "ç©å®¶A" else "ç©å®¶A"

st.info(f"å½“å‰æ“ä½œè€…ï¼š{current_roller} | æ­£åœ¨æŠ½å–ï¼š{target_user} çš„è®¸æ„¿æ± ")

selected_level = st.selectbox("ğŸ¯ æƒ³è¦æŒ‘æˆ˜å“ªä¸ªæ¡£ä½ï¼Ÿ", LEVELS)

if st.button(f"ğŸ² æŠ½å– {target_user} çš„æ„¿æœ›"):
    target_pool = st.session_state.pools[target_user][selected_level]
    
    if not target_pool:
        st.error(f"å“å‘€ï¼Œ{target_user} è¿˜æ²¡æœ‰åœ¨ã€{selected_level}ã€‘é‡Œå†™æ„¿æœ›å‘¢ï¼")
    else:
        with st.spinner('å‘½è¿è½¬è½®æ‹¨åŠ¨ä¸­...'):
            import time
            time.sleep(1.2)
            result = random.choice(target_pool)
            st.balloons()
            st.markdown(f"### ğŸ‰ æ­å–œ {current_roller}ï¼")
            st.markdown(f"ä½ æŠ½ä¸­äº† {target_user} çš„å¥–å“ï¼š")
            st.subheader(f"ã€{result}ã€‘")
            st.caption(f"ï¼ˆæ¡£ä½ï¼š{selected_level}ï¼‰")

# é¡µè„šæç¤º
st.markdown("---")
st.caption("ğŸ”’ æç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªæœ¬åœ°ä¸´æ—¶ç¨‹åºï¼Œåˆ·æ–°æµè§ˆå™¨é¡µé¢ä¼šå¯¼è‡´æ„¿æœ›æ± æ¸…ç©ºã€‚å»ºè®®å¡«å¥½åç›´æ¥å¼€å§‹æŠ½å¥–ï¼")
